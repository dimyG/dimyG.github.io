<!DOCTYPE html><html lang="en" > <!-- The Head v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta property="og:description" content="" /><title>Understanding HTTP Caching | Dimitris Georgoulas</title><meta name="generator" content="Jekyll v4.0.1" /><meta property="og:title" content="Understanding HTTP Caching" /><meta name="author" content="Dimitris Georgoulas" /><meta property="og:locale" content="en_US" /><meta name="description" content="Server caches and Downstream caches HTTP caching mechanisms can be a bit confusing at first so let’s start clarifying them a bit. I would like to start by noting that in a typical client web server architecture there isn’t only one cache, there are many. There are server side caches and downstream caches. A server side cache can be a key-value store like redis or memcached for example. Apart from that there are also the so called downstream caches that store the response after it has left “the server”. The most obvious downstream cache is the browser’s cache. Have in mind though that there can be additional downstream caches between the server and the browser, for example your ISP’s cache." /><meta property="og:description" content="Server caches and Downstream caches HTTP caching mechanisms can be a bit confusing at first so let’s start clarifying them a bit. I would like to start by noting that in a typical client web server architecture there isn’t only one cache, there are many. There are server side caches and downstream caches. A server side cache can be a key-value store like redis or memcached for example. Apart from that there are also the so called downstream caches that store the response after it has left “the server”. The most obvious downstream cache is the browser’s cache. Have in mind though that there can be additional downstream caches between the server and the browser, for example your ISP’s cache." /><link rel="canonical" href="https://dimyg.github.io/posts/understanding-http-caching/" /><meta property="og:url" content="https://dimyg.github.io/posts/understanding-http-caching/" /><meta property="og:site_name" content="Dimitris Georgoulas" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-05-01T09:30:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Understanding HTTP Caching" /><meta name="twitter:site" content="@DimiGeorgoulas" /><meta name="twitter:creator" content="@Dimitris Georgoulas" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@type":"BlogPosting","headline":"Understanding HTTP Caching","url":"https://dimyg.github.io/posts/understanding-http-caching/","dateModified":"2020-05-01T09:30:00+00:00","datePublished":"2020-05-01T09:30:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://dimyg.github.io/posts/understanding-http-caching/"},"author":{"@type":"Person","name":"Dimitris Georgoulas"},"description":"Server caches and Downstream caches HTTP caching mechanisms can be a bit confusing at first so let’s start clarifying them a bit. I would like to start by noting that in a typical client web server architecture there isn’t only one cache, there are many. There are server side caches and downstream caches. A server side cache can be a key-value store like redis or memcached for example. Apart from that there are also the so called downstream caches that store the response after it has left “the server”. The most obvious downstream cache is the browser’s cache. Have in mind though that there can be additional downstream caches between the server and the browser, for example your ISP’s cache.","@context":"https://schema.org"}</script> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT license --><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/popper.js@1.15.0/dist/umd/popper.min.js" integrity="sha256-fTuUgtT7O2rqoImwjrhDgbXTKUwyxxujIMRIK7TbuNU=" crossorigin> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script> window.jQuery || document.write('<script src="/assets/lib/jquery-3.4.1.min.js"><\/script>'); </script> <script src="https://cdn.jsdelivr.net/npm/popper.js@1.15.0/dist/umd/popper.min.js" integrity="sha256-fTuUgtT7O2rqoImwjrhDgbXTKUwyxxujIMRIK7TbuNU=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha256-5+02zu5UULQkO7w1GIr6vftCgMfFdZcAHeDtFnKZsBs=" crossorigin="anonymous" async></script> <script src="/assets/js/dist/commons.js" async></script> <script src="/assets/js/dist/timeago.min.js" async></script><link rel="preload" as="script" href="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.js"> <script src="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.js" async></script> <script src="/assets/js/dist/toc.min.js" async></script> <script src="/assets/js/dist/tooltip-loader.min.js" async></script> <script src="/app.js" defer></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/sample/olympus_rec_3.jpg" alt="avatar"> </a></div><div class="profile-text mt-3"><div id="site-title"> <a href="/">Dimitris Georgoulas</a></div><div id="site-subtitle" class="font-italic">Full stack web developer, Mechanical engineer, Father, Husband, Passionate about learning, Excited with technology, Located in Thessaloniki, Greece</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-3 mr-3 unloaded"></i> <span>HOME</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-3 mr-3 unloaded"></i> <span>CATEGORIES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-3 mr-3 unloaded"></i> <span>ARCHIVES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-3 mr-3 unloaded"></i> <span>ABOUT</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/donate/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-heart ml-3 mr-3 unloaded"></i> <span>DONATE</span> </a></li></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <!-- Switch the mode between dark and light. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightkMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightkMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border" style="color: green"></span> <a href="https://github.com/dimyG" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://stackoverflow.com/users/2369865/dimyg" target="_blank"> <i class="fab fa-stack-overflow"></i> </a> <a href="https://twitter.com/DimiGeorgoulas" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href="javascript:window.open('mailto:' + ['dimgeows','gmail.com'].join('@'))"> <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" target="_blank"> <i class="fas fa-rss"></i> </a></div></div><!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Understanding HTTP Caching</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Understanding HTTP Caching</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago" data-toggle="tooltip" data-placement="bottom" title="Fri, May 1, 2020, 9:30 AM +0000"> May 1, 2020 <i class="unloaded">2020-05-01T09:30:00+00:00</i> </span> by <span class="author"> Dimitris Georgoulas </span></div><div> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, Aug 3, 2020, 4:38 PM +0300"> Aug 3, 2020 <i class="unloaded">2020-08-03T13:38:40+00:00</i> </span></div></div><div class="post-content"><h2 id="server-caches-and-downstream-caches">Server caches and Downstream caches</h2><p>HTTP caching mechanisms can be a bit confusing at first so let’s start clarifying them a bit. I would like to start by noting that in a typical client web server architecture there isn’t only one cache, there are many. There are server side caches and downstream caches. A server side cache can be a key-value store like redis or memcached for example. Apart from that there are also the so called downstream caches that store the response after it has left “the server”. The most obvious downstream cache is the browser’s cache. Have in mind though that there can be additional downstream caches between the server and the browser, for example your ISP’s cache.</p><p>In any case, you have the power to control the behaviour of these caches or in other words when and how a response is stored and retrieved from them, using HTTP headers. Headers like <code class="highlighter-rouge">Cache-Control</code>, <code class="highlighter-rouge">Expires</code>, <code class="highlighter-rouge">ETag</code>, <code class="highlighter-rouge">Last-Modified</code> and <code class="highlighter-rouge">Vary</code>. Let’s dig into them…</p><h2 id="cache-control-max-age-and-expires">Cache-Control max-age and Expires</h2><p><code class="highlighter-rouge">Cache-Control</code> has many directives one of which is the <code class="highlighter-rouge">max-age</code> with which you can define for how many seconds after the first request, you want the response to be stored in a cache. If a request for the same resource is done within this time frame then the cached response will be used no matter what. <code class="highlighter-rouge">Expires</code> on the other hand does the same thing, with the difference that you define a specific date and time until which the cached response is valid. This has the disadvantage that if there are a lot of clients with the same cached data and the same Expires header, all these responses will expire at the same time and all clients might request the new resource at the same time overloading your servers. In any case the <code class="highlighter-rouge">Cache-Control</code> header is newer, more versatile and takes precedence over <code class="highlighter-rouge">Expires</code> if both are present. So the only reason you might want to still use the Expires header is for outdated downstream caches which might not support the <code class="highlighter-rouge">Cache-Control</code> header yet.</p><h2 id="etag-and-last-modified">ETag and Last-Modified</h2><p>At first the browser checks the <code class="highlighter-rouge">Cache-Control</code> or <code class="highlighter-rouge">Expires</code> headers to determine whether or not to make a request to the server. If it has to make a request, then there are some additional headers that control what happens next. Meet <code class="highlighter-rouge">Etag</code> and <code class="highlighter-rouge">Last-Modified</code> response headers. <code class="highlighter-rouge">ETag</code> is usually a checksum of the response which means that it changes whenever the response changes while <code class="highlighter-rouge">Last-Modified</code> is a datetime which declares when the response was last modified. These values are both calculated by your server. If an <code class="highlighter-rouge">ETag</code> header is present in a response, for example <code class="highlighter-rouge">ETag: "value_01"</code> and the browser makes a request for that resource, then it will add the request header <code class="highlighter-rouge">If-None-Match: "value_01"</code>. The server will calculate the ETag value for that response and if it matches the one that came with the request, it will respond with a status code 304 (Not Modified) and an empty body. So the cached value will be used. If the response has changed, then the ETag value calculated by the server will be different and a new response will be created and send to the client. <code class="highlighter-rouge">Last-Modified</code> works in a similar way but instead of calculating and comparing a checksum value it calculates and compares a datetime value. The browser sends an <code class="highlighter-rouge">If-Modified-Since: &lt;date and time&gt;</code> request header. You can choose to use whichever of the two best suits you.</p><h2 id="etag-example">ETag example</h2><ul><li>Browser_A makes a GET request for page_1</li><li>Page_1 doesn’t exist in browser’s_A cache. The request reaches the server. It doesn’t exist in the server cache. It is calculated. The response is added in the server cache along with its ETag value written as a response header. The response reaches the browser, is stored in its own cache and is presented to the user.</li><li>Browser_B requests the same page_1. It is not in its cache. The request reaches the server but the response is not calculated again since it exists in the server cache from where is retrieved and returned to the browser.</li><li>Browser_A requests the page_1 again. Since there is no Expires or Cache-Control max age headers, only an ETag, it doesn’t get the page from ts cache but sends a request to the server along with its cached ETag value. The server calculates the current ETag value for that page. If it hasn’t changed then it responds with a simple 304 not modified response. The response reaches the browser which serves the user with its cached page.</li><li>The database is updated which means that page_1 changes and a new ETag value must be generated for it. Browser_A requests page_1. The server calculates the ETag value and sees that it doesn’t match with the request’s ETag value. It runs its business logic to calculate the new response and sends it to the browser. The browser serves it to the user and updates its cache with the new page_1 that has a new ETag header</li></ul><h2 id="caching-variable-and-private-data">Caching variable and private data</h2><p>Caching is an excellent efficiency boost, but there’s a danger to it. Cached data is stored as key-value pairs and many systems create the key for a web page from its url. The problem is that the same url might return different content based on which user sees the page or based on any other variable like if the client is a mobile device or not. Extra care must be taken for cases like this and the solution is the use of the <code class="highlighter-rouge">Vary</code> header. Using this header you can vary a response based on any request header. For example, if you define <code class="highlighter-rouge">Vary: User-Agent</code> then the caching servers should consider the user agent when deciding whether to serve the page from cache or not. If the <code class="highlighter-rouge">User-Agent</code> request header is the same with the one that was used when the page was first cached, then the page will be retrieved from the cache. Otherwise a request to the server will be made, a new response will be received and will overwrite the current cached version.</p><p>In other scenarios there are pages that contain private information which you don’t want to save on any public cache like the ISP’s cache for example, but only in private caches like the client’s browser cache. For these cases you can use the versatile Cache-Control header with the private directive, <code class="highlighter-rouge">Cache-Control: private</code>. For very sensitive data like credit card details that you don’t want to be stored at all you can use <code class="highlighter-rouge">Cache-Control: no-store</code>.</p><h2 id="caching-in-django-in-a-nutshell">Caching in django in a nutshell</h2><p>I will probably create a whole new post for this subject but until then, I live this overview of django caching here…</p><p>As we said, the cached responses might be stored in more than one caches, for example in the server’s cache and in the browser’s cache. Django offers you the proper tools that make it very easy to control the server cache and also to define the browser’s cache behaviour using HTTP headers.</p><p>Before deciding which data should be cached, you first have to select where the data is going to be stored or in other words what server cache you will use. Django supports many options like a database, the filesystem, the server’s memory or even better, external services like Memcached or Redis. Your cache preference goes in the <code class="highlighter-rouge">CACHES</code> setting in your settings file. After setting up where the cached data is stored you can move on to defining which data should be cached.</p><p>Django gives you full power over caching. First of all it offers different levels of cache granularity:</p><ol><li>You can cache your entire site</li><li>You can cache specific views</li><li>You can cache only the pieces that are difficult to produce</li></ol><h3 id="caching-the-entire-site">Caching the entire site</h3><p>The simplest way to use caching is to cache your entire site. Basically this is achieved with the use of middleware. The <code class="highlighter-rouge">FetchFromCacheMiddleware</code> that caches GET and HEAD responses with status 200, where the request and response headers allow and the <code class="highlighter-rouge">UpdateCacheMiddleware</code> that automatically sets the Expires and Cache-Control (with max-age directive) headers in each response. You just need to add these middleware to your MIDDLEWARE setting in the django settings file and define the default cache options.</p><blockquote><p><strong><em>Note</em></strong>: You can disable caching for a view using the <code class="highlighter-rouge">@never_cache()</code> decorator. This decorator adds a “Cache-Control: max-age=0, no-cache, no-store, must-revalidate, private” header to a response to indicate that a page should never be cached. You can also easily patch the response’s Cache-Control header using the <code class="highlighter-rouge">@cache_control()</code> decorator. For example if you don’t want to use the default expiry time for a view, you can easily change it by decorating it with: @cache_control(max-age=60*15) or you can instruct public caches to not store a view with: @cache_control(private=True)</p></blockquote><p>Cached data is stored in <strong>key-value pairs</strong>, so in order to understand when a cached value is accessed or not, we must understand how these keys are created. By default, Django’s cache system creates its cache keys using the requested fully-qualified URL, for example https://www.example.com/stories/2005/?order_by=author. If the key which is created by this url exists in the cache, then any request for this url will receive the cached value.</p><p>You can change the way the keys are being created using the Vary header. The Vary header defines which request headers a cache mechanism should take into account when building its cache key. The Vary header is controlled in django by the the <code class="highlighter-rouge">@vary_on_headers</code> view decorator. For example if we want to cache a different version of a page for each combination of User-Agent and Accept-Encoding Headers we can simply do:</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="o">@</span><span class="n">vary_on_headers</span><span class="p">(</span><span class="s">'User-Agent, Accept-Encoding'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="p">...</span>
</pre></table></code></div></div><blockquote><p><strong><em>Note</em></strong>: When you use cookie based session authentication (where the session id is stored in a cookie) and the same url returns different content based on which user requested the page, you need to vary the cached page by cookie. Luckily, in this case (where the session middleware is used and session is accessed in a view), django will automatically add <code class="highlighter-rouge">Vary:Cookie</code> header to the response so you don’t have to do it yourself.</p></blockquote><h3 id="caching-specific-views">Caching specific views</h3><p>In the previous approach we cache the entire site by default and externally specify what we don’t want to cache (or we want to cache differently). This is not always the best approach since you might end up caching things that shouldn’t be cached. Another approach is to cache nothing by default and externally define what pages you want to cache and how. This is achieved with the <code class="highlighter-rouge">@cache_page</code> decorator.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="o">@</span><span class="n">cache_page</span><span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">15</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="p">...</span>
</pre></table></code></div></div><blockquote><p><strong><em>Note</em></strong>: The per-view cache, like the per-site cache, is keyed off of the URL.</p></blockquote><h3 id="caching-specific-pieces">Caching specific pieces</h3><p>Sometimes, caching an entire page like the per-site or per-view cache strategies do, is not the best approach. For example you might have a view whose results depend on several expensive queries, the results of which change at different intervals. In this case you don’t want to cache the entire page but you still want to cache those expensive results. To do so you can use django’s low level cache API. Using it you can cache any Python object that can be <a href="https://docs.python.org/3/library/pickle.html#module-pickle">pickled</a> safely, like strings, dictionaries, lists of model objects. You first access your configured caches defined in the CACHES setting through django.core.cache.caches and then externally store and retrieve things from it.</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">django.core.cache</span> <span class="kn">import</span> <span class="n">caches</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">my_cache</span> <span class="o">=</span> <span class="n">caches</span><span class="p">[</span><span class="s">'default'</span><span class="p">]</span>
    <span class="n">my_cache</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="s">'my_key'</span><span class="p">,</span> <span class="n">my_value</span><span class="p">,</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">15</span><span class="p">)</span>
    <span class="n">my_cache</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'my_key'</span><span class="p">)</span>
    <span class="p">...</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/web-development/'>Web-Development</a>, <a href='/categories/django/'>Django</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/django/" class="post-tag no-text-decoration" >django</a> <a href="/tags/http/" class="post-tag no-text-decoration" >http</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center pt-5 pb-2"> <!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Understanding HTTP Caching - Dimitris Georgoulas&url=https://dimyg.github.io/posts/understanding-http-caching/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Understanding HTTP Caching - Dimitris Georgoulas&u=https://dimyg.github.io/posts/understanding-http-caching/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Understanding HTTP Caching - Dimitris Georgoulas&url=https://dimyg.github.io/posts/understanding-http-caching/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/zakanda_technical_overview/">Zakanda technical overview</a></li><li><a href="/posts/my-experience-as-a-cae-engineer/">My experience as a CAE engineer</a></li><li><a href="/posts/my-epic-fail-as-a-sports-betting-entrepreneur/">My epic fail as a sports betting entrepreneur</a></li><li><a href="/posts/aws-ecs-overview/">AWS Elastic Container Service overview</a></li><li><a href="/posts/django-tips/">Django Random Tips</a></li></ul></div><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/work-experience/">work experience</a> <a class="post-tag" href="/tags/django/">django</a> <a class="post-tag" href="/tags/economics/">economics</a> <a class="post-tag" href="/tags/zakanda/">zakanda</a> <a class="post-tag" href="/tags/tips/">tips</a> <a class="post-tag" href="/tags/machine-learning/">machine learning</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/react/">react</a> <a class="post-tag" href="/tags/philosophy/">philosophy</a> <a class="post-tag" href="/tags/notes/">notes</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-3">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="post-extend-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Navigation buttons at the bottom of the post. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --><div class="post-navigation d-flex justify-content-between"> <a href="/posts/aws-ecs-overview/" class="btn btn-outline-primary"><p>AWS Elastic Container Service overview</p></a> <a href="/posts/javascript-essentials-some-tips/" class="btn btn-outline-primary"><p>Javascript Essentials, some tips</p></a></div><!-- The related posts of current post. Placed in the bottom of every single post. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div id="related-posts" class="mt-4 mb-2 mb-sm-4 pb-2"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/function-vs-class-based-views-in-django-rest/"><div class="card-body"> <span class="timeago small"> Apr 29, 2020 <i class="unloaded">2020-04-29T09:30:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Function vs Class based views in Django Rest Framework</h3><div class="text-muted small"><p>Customization or standardization Similarly to django, django rest framework offers you the choice of using class based views. As most things in life class based views come with their own pros and ...</p></div></div></a></div><div class="card"> <a href="/posts/django-tips/"><div class="card-body"> <span class="timeago small"> May 4, 2020 <i class="unloaded">2020-05-04T00:30:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Django Random Tips</h3><div class="text-muted small"><p>Avoiding race conditions in django Use an F() expression when updating a model field’s value relatively to its previous value. For example: 1 2 3 4 5 from django.db.models import F product =...</p></div></div></a></div><div class="card"> <a href="/posts/zakanda_technical_overview/"><div class="card-body"> <span class="timeago small"> Jun 3, 2020 <i class="unloaded">2020-06-03T09:33:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Zakanda technical overview</h3><div class="text-muted small"><p>Introduction zakanda is my first entrepreneurial endeavor which… failed miserably. You can read the juicy details in my epic fail as a sports betting entrepreneur story. It was aspired to be a sp...</p></div></div></a></div></div></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const el = document.querySelectorAll('#post-wrapper img'); const observer = lozad(el); observer.observe(); </script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2020 <a href="https://twitter.com/DimiGeorgoulas">Dimitris Georgoulas</a></p></div><div class="footer-left"><p class="mb-0"> <span data-toggle="tooltip" data-placement="top" title="Donations"> <a href="/donate/"><b>Donate</b></a> </span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/">Chirpy</a> theme.</p></div></div></footer></div><!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/work-experience/">work experience</a> <a class="post-tag" href="/tags/django/">django</a> <a class="post-tag" href="/tags/economics/">economics</a> <a class="post-tag" href="/tags/zakanda/">zakanda</a> <a class="post-tag" href="/tags/tips/">tips</a> <a class="post-tag" href="/tags/machine-learning/">machine learning</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/react/">react</a> <a class="post-tag" href="/tags/philosophy/">philosophy</a> <a class="post-tag" href="/tags/notes/">notes</a></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- The GA snippet v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-M68HVLYFY2"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-M68HVLYFY2'); </script> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js" integrity="sha256-qcLR00zq6pJk4je3MLgAri8Nn+ZumUlXgTKR2H/xCY0=" crossorigin="anonymous"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://dimyg.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
